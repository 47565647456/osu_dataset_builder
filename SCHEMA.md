# osu-dataset-builder Schema

This document describes the parquet file schemas generated by osu-dataset-builder.

## Overview

The dataset consists of 14 parquet files organized into logical groups:

| Group | Files | Description |
|-------|-------|-------------|
| **Core** | beatmaps, hit_objects, timing_points | Main beatmap data |
| **Sliders** | slider_control_points, slider_data | Slider curve details |
| **Storyboard** | storyboard_elements, storyboard_commands, storyboard_loops, storyboard_triggers | Storyboard animations |
| **Events** | breaks, combo_colors, hit_samples | Per-beatmap visual/audio events |

---

## beatmaps.parquet

Core beatmap metadata. One row per `.osu` file.

| Column | Type | Description |
|--------|------|-------------|
| folder_id | string | Beatmap folder name |
| osu_file | string | `.osu` filename |
| format_version | int32 | osu! file format version |
| audio_file | string | Audio filename |
| audio_lead_in | float64 | Milliseconds before audio starts |
| preview_time | int32 | Audio preview start time |
| default_sample_bank | int32 | Default hitsound bank (0=None, 1=Normal, 2=Soft, 3=Drum) |
| default_sample_volume | int32 | Default hitsound volume (0-100) |
| stack_leniency | float32 | Note stacking threshold |
| mode | int32 | Game mode (0=osu!, 1=Taiko, 2=Catch, 3=Mania) |
| letterbox_in_breaks | bool | Letterbox during breaks |
| special_style | bool | N+1 key style for mania |
| widescreen_storyboard | bool | Storyboard supports widescreen |
| epilepsy_warning | bool | Show epilepsy warning |
| samples_match_playback_rate | bool | Hitsounds scale with speed mods |
| countdown | int32 | Countdown type (0=None, 1=Normal, 2=Half, 3=Double) |
| countdown_offset | int32 | Countdown beat offset |
| bookmarks | string | Comma-separated editor bookmarks |
| distance_spacing | float64 | Editor distance snap |
| beat_divisor | int32 | Editor beat snap divisor |
| grid_size | int32 | Editor grid size |
| timeline_zoom | float64 | Editor timeline zoom |
| title | string | Song title (ASCII) |
| title_unicode | string | Song title (Unicode) |
| artist | string | Artist name (ASCII) |
| artist_unicode | string | Artist name (Unicode) |
| creator | string | Mapper username |
| version | string | Difficulty name |
| source | string | Song source (game, anime, etc.) |
| tags | string | Space-separated search tags |
| beatmap_id | int32 | Beatmap ID |
| beatmap_set_id | int32 | Beatmapset ID |
| hp_drain_rate | float32 | HP drain (0-10) |
| circle_size | float32 | Circle size (0-10) |
| overall_difficulty | float32 | Overall difficulty (0-10) |
| approach_rate | float32 | Approach rate (0-10) |
| slider_multiplier | float64 | Base slider velocity |
| slider_tick_rate | float64 | Slider tick rate |
| background_file | string | Background image filename |
| audio_path | string | Full audio path in assets |
| background_path | string | Full background path in assets |

---

## hit_objects.parquet

Hit objects (circles, sliders, spinners). Ordered by start_time.

| Column | Type | Nullable | Description |
|--------|------|----------|-------------|
| folder_id | string | | Beatmap folder |
| osu_file | string | | `.osu` filename |
| index | int32 | | Object index (0-based) |
| start_time | float64 | | Start time in ms |
| object_type | string | | `circle`, `slider`, or `spinner` |
| pos_x | int32 | ✓ | X position (0-512) |
| pos_y | int32 | ✓ | Y position (0-384) |
| new_combo | bool | | Starts a new combo |
| combo_offset | int32 | | Combo color skip count |
| curve_type | string | ✓ | Slider: `B`, `C`, `L`, `P` |
| slides | int32 | ✓ | Slider repeat count |
| length | float64 | ✓ | Slider length in osupixels |
| end_time | float64 | ✓ | End time (spinners/sliders) |

---

## timing_points.parquet

Timing and inherited timing points.

| Column | Type | Nullable | Description |
|--------|------|----------|-------------|
| folder_id | string | | Beatmap folder |
| osu_file | string | | `.osu` filename |
| time | float64 | | Time in ms |
| point_type | string | | `timing` or `inherited` |
| beat_length | float64 | ✓ | Ms per beat (timing points) |
| time_signature | string | ✓ | e.g., "4/4" |
| slider_velocity | float64 | ✓ | SV multiplier (inherited) |
| kiai | bool | ✓ | Kiai mode active |
| sample_bank | string | ✓ | Hitsound bank override |
| sample_volume | int32 | ✓ | Volume override |

---

## slider_control_points.parquet

Slider Bézier/path control points.

| Column | Type | Nullable | Description |
|--------|------|----------|-------------|
| folder_id | string | | Beatmap folder |
| osu_file | string | | `.osu` filename |
| hit_object_index | int32 | | Parent slider index |
| point_index | int32 | | Control point index |
| pos_x | float32 | | X position |
| pos_y | float32 | | Y position |
| path_type | string | ✓ | Curve type at this point |

---

## slider_data.parquet

Additional slider metadata.

| Column | Type | Nullable | Description |
|--------|------|----------|-------------|
| folder_id | string | | Beatmap folder |
| osu_file | string | | `.osu` filename |
| hit_object_index | int32 | | Parent slider index |
| repeat_count | int32 | | Number of repeats |
| velocity | float64 | | Computed slider velocity |
| expected_dist | float64 | ✓ | Expected travel distance |

---

## breaks.parquet

Break periods during gameplay.

| Column | Type | Description |
|--------|------|-------------|
| folder_id | string | Beatmap folder |
| osu_file | string | `.osu` filename |
| start_time | float64 | Break start in ms |
| end_time | float64 | Break end in ms |

---

## combo_colors.parquet

Custom combo and skin colors.

| Column | Type | Nullable | Description |
|--------|------|----------|-------------|
| folder_id | string | | Beatmap folder |
| osu_file | string | | `.osu` filename |
| color_index | int32 | | Color order (0-based) |
| color_type | string | | `combo` or `custom` |
| custom_name | string | ✓ | Custom color key name |
| red | int32 | | R component (0-255) |
| green | int32 | | G component (0-255) |
| blue | int32 | | B component (0-255) |

---

## hit_samples.parquet

Per-hit-object hitsound samples.

| Column | Type | Nullable | Description |
|--------|------|----------|-------------|
| folder_id | string | | Beatmap folder |
| osu_file | string | | `.osu` filename |
| hit_object_index | int32 | | Parent hit object |
| sample_index | int32 | | Sample index for this object |
| name | string | | Sample name (Normal, Whistle, Finish, Clap) |
| bank | string | | Sample bank |
| suffix | string | ✓ | Custom sample suffix |
| volume | int32 | | Volume (0-100) |

---

## storyboard_elements.parquet

Storyboard sprites and animations.

| Column | Type | Nullable | Description |
|--------|------|----------|-------------|
| folder_id | string | | Beatmap folder |
| source_file | string | | Source `.osu` or `.osb` file |
| element_index | int32 | | Element index |
| layer_name | string | | Layer (Background, Fail, Pass, Foreground) |
| element_path | string | | Image/animation path |
| element_type | string | | `sprite` or `animation` |
| origin | string | | Anchor point (Centre, TopLeft, etc.) |
| initial_pos_x | float32 | | Initial X position |
| initial_pos_y | float32 | | Initial Y position |
| frame_count | int32 | ✓ | Animation frame count |
| frame_delay | float64 | ✓ | Animation frame delay |
| loop_type | string | ✓ | Animation loop type |
| is_embedded | bool | | Embedded in .osu (vs standalone .osb) |

---

## storyboard_commands.parquet

Storyboard animation commands with easing.

| Column | Type | Description |
|--------|------|-------------|
| folder_id | string | Beatmap folder |
| source_file | string | Source `.osu` or `.osb` file |
| element_index | int32 | Parent element index |
| command_type | string | `x`, `y`, `scale`, `rotation`, `alpha`, `color`, `flip_h`, `flip_v`, `vector_scale`, `blending` |
| start_time | float64 | Command start in ms |
| end_time | float64 | Command end in ms |
| start_value | string | Start value (format depends on type) |
| end_value | string | End value (format depends on type) |
| easing | int32 | Easing function (0-34, see osu! wiki) |
| is_embedded | bool | Embedded in .osu |

---

## storyboard_loops.parquet

Storyboard loop definitions.

| Column | Type | Description |
|--------|------|-------------|
| folder_id | string | Beatmap folder |
| source_file | string | Source file |
| element_index | int32 | Parent element |
| loop_index | int32 | Loop index for this element |
| loop_start_time | float64 | Loop start in ms |
| loop_count | int32 | Number of iterations |
| is_embedded | bool | Embedded in .osu |

---

## storyboard_triggers.parquet

Storyboard trigger definitions.

| Column | Type | Description |
|--------|------|-------------|
| folder_id | string | Beatmap folder |
| source_file | string | Source file |
| element_index | int32 | Parent element |
| trigger_index | int32 | Trigger index |
| trigger_name | string | Trigger type (Passing, Failing, etc.) |
| trigger_start_time | float64 | Trigger start in ms |
| trigger_end_time | float64 | Trigger end in ms |
| group_number | int32 | Trigger group |
| is_embedded | bool | Embedded in .osu |

---

## Key Relationships

```
beatmaps (1) ─────┬───── (N) hit_objects ────── (N) hit_samples
                  │                     └────── (N) slider_control_points
                  │                     └────── (1) slider_data
                  ├───── (N) timing_points
                  ├───── (N) breaks
                  └───── (N) combo_colors

storyboard_elements (1) ─┬───── (N) storyboard_commands
                         ├───── (N) storyboard_loops
                         └───── (N) storyboard_triggers
```

---

# Enriched Data (osu-enricher)

The following tables are generated by `osu-enricher` from the osu! API and local PP calculations.

## beatmap_enriched.parquet

Comprehensive beatmap data combining API metadata and rosu-pp calculations. One row per beatmap.

### Identifiers

| Column | Type | Description |
|--------|------|-------------|
| beatmap_id | uint32 | Beatmap ID |
| beatmapset_id | uint32 | Beatmapset ID |
| folder_id | string | Beatmap folder |
| osu_file | string | `.osu` filename |

### API Metadata (BeatmapExtended)

| Column | Type | Description |
|--------|------|-------------|
| mode | string | Game mode: osu, taiko, catch, mania |
| version | string | Difficulty name |
| url | string | Full beatmap URL |
| status | string | Ranked, Loved, Graveyard, etc. |
| is_scoreable | bool | Can submit scores |
| convert | bool | Is a converted map |

### Difficulty Settings

| Column | Type | Description |
|--------|------|-------------|
| ar | float32 | Approach rate |
| cs | float32 | Circle size |
| od | float32 | Overall difficulty |
| hp | float32 | HP drain |
| bpm | float32 | Beats per minute |

### Object Counts

| Column | Type | Description |
|--------|------|-------------|
| count_circles | uint32 | Number of circles |
| count_sliders | uint32 | Number of sliders |
| count_spinners | uint32 | Number of spinners |

### Length & Stats

| Column | Type | Description |
|--------|------|-------------|
| seconds_drain | uint32 | Drain time in seconds |
| seconds_total | uint32 | Total length in seconds |
| playcount | uint32 | Total play count |
| passcount | uint32 | Total pass count |
| max_combo_api | uint32? | Max combo (from API) |
| stars_api | float32 | Star rating (from API) |

### Other

| Column | Type | Description |
|--------|------|-------------|
| checksum | string | MD5 hash |
| creator_id | uint32 | Mapper user ID |
| last_updated | int64? | Unix timestamp |

### PP Calculation (rosu-pp)

| Column | Type | Description |
|--------|------|-------------|
| stars_calc | float64 | Calculated star rating |
| max_pp | float64 | Max PP (SS, nomod) |
| max_combo_calc | uint32 | Calculated max combo |

### osu! Mode Specific

| Column | Type | Description |
|--------|------|-------------|
| osu_aim | float64? | Aim difficulty |
| osu_speed | float64? | Speed difficulty |
| osu_flashlight | float64? | Flashlight difficulty |
| osu_slider_factor | float64? | Slider factor |
| osu_speed_note_count | float64? | Speed notes count |
| osu_aim_difficult_slider_count | float64? | Difficult slider count |
| osu_aim_difficult_strain_count | float64? | Aim strain count |
| osu_speed_difficult_strain_count | float64? | Speed strain count |
| osu_great_hit_window | float64? | Great (300) hit window |
| osu_ok_hit_window | float64? | OK (100) hit window |
| osu_meh_hit_window | float64? | Meh (50) hit window |
| osu_n_large_ticks | uint32? | Large tick count |

### taiko Mode Specific

| Column | Type | Description |
|--------|------|-------------|
| taiko_stamina | float64? | Stamina difficulty |
| taiko_rhythm | float64? | Rhythm difficulty |
| taiko_color | float64? | Color difficulty |
| taiko_reading | float64? | Reading difficulty |
| taiko_great_hit_window | float64? | Great hit window |
| taiko_ok_hit_window | float64? | OK hit window |
| taiko_mono_stamina_factor | float64? | Mono stamina factor |

### catch Mode Specific

| Column | Type | Description |
|--------|------|-------------|
| catch_ar | float64? | Approach rate (calculated) |
| catch_n_fruits | uint32? | Fruit count |
| catch_n_droplets | uint32? | Droplet count |
| catch_n_tiny_droplets | uint32? | Tiny droplet count |

### mania Mode Specific

| Column | Type | Description |
|--------|------|-------------|
| mania_n_objects | uint32? | Object count |
| mania_n_hold_notes | uint32? | Hold note count |

### Common (for converts)

| Column | Type | Description |
|--------|------|-------------|
| is_convert | bool? | Whether map is a convert |

### Status

| Column | Type | Description |
|--------|------|-------------|
| pp_failed | string? | Reason if PP calculation failed (e.g. "Suspicious map: Density") |

---

## beatmap_comments.parquet

Beatmapset comments from the osu! API. Includes main comments, replies, and pinned comments.

| Column | Type | Nullable | Description |
|--------|------|----------|-------------|
| beatmapset_id | uint32 | | Beatmapset ID this comment belongs to |
| comment_id | uint32 | | Comment ID |
| parent_id | uint32 | ✓ | Parent comment ID (for replies) |
| user_id | uint32 | ✓ | Commenter user ID |
| legacy_name | string | ✓ | Legacy username (for old comments) |
| message | string | ✓ | Comment content (markdown) |
| message_html | string | ✓ | Comment content (HTML) |
| votes_count | uint32 | | Number of upvotes |
| replies_count | uint32 | | Number of replies |
| pinned | bool | | Whether comment is pinned |
| commentable_type | string | | Object type (beatmapset) |
| created_at | int64 | | Creation timestamp (Unix) |
| updated_at | int64 | | Last update timestamp (Unix) |
| edited_at | int64 | ✓ | Edit timestamp (Unix) |
| edited_by_id | uint32 | ✓ | Editor user ID |
| deleted_at | int64 | ✓ | Deletion timestamp (Unix) |
